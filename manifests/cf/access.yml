---
instance_groups:
- name: access
  jobs:
  - name: consul_agent
    release: consul
    consumes:
      consul_common: {from: consul_common_link}
      consul_server: nil
      consul_client: {from: consul_client_link}
  - name: ssh_proxy
    release: diego
    properties:
      diego:
        ssl:
          skip_cert_verify: (( grab params.skip_ssl_validation ))
        ssh_proxy:
          bbs:
            .: (( inject meta.certs.diego.bbs.client ))
            require_ssl: true
            ca_cert: (( grab meta.certs.diego.ca ))
          enable_cf_auth: true
          host_key: (( vault meta.vault "/ssh_proxy/host_key:private" ))
          uaa_secret: (( grab meta.uaa.ssh_proxy_secret ))
          uaa:
            port: (( grab meta.uaa.ssl_port ))
            ca_cert: (( grab meta.certs.uaa.ca ))

  - { name: file_server,    release: diego }