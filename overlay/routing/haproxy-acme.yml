---
meta:
  ocfp:
    certs:
      acme_thumbprint:  (( vault $GENESIS_EXODUS_MOUNT genesis.env "/acme/acme:thumbprint" ))
instance_groups:
- name: haproxy
  jobs:
  - name: haproxy
    properties:
      ha_proxy:
        frontend_config: |
          acl is_acme_challenge path_beg /.well-known/acme-challenge/
          http-request return status 200 content-type text/plain lf-string "%[path,field(-1,/)].%[env(ACCOUNT_THUMBPRINT)]\n" if is_acme_challenge
        global_config: (( concat "setenv ACCOUNT_THUMBPRINT '" meta.ocfp.certs.acme_thumbprint "'"))