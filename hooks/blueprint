#!/bin/bash
set -eu

declare -a merge

merge=( \
  cf-deployment/cf-deployment.yml \
  # cf-deployment/operations/rename-network-and-deployment.yml
)

# Do features => opsfiles stuff here

for __feature in $GENESIS_REQUESTED_FEATURES; do
  if [[ $__feature =~ cf-deployment/.* ]] ; then
    if [[ -f "$__feature.yml" ]] ; then
      merge+=( "$__feature.yml" )
    else
      __bail "GENESIS_KIT_NAME/$GENESIS_KIT_VERSION does not support the $__feature feature"
    fi
  elif [[ -f $GENESIS_ROOT/ops/$__feature.yml ]] ; then
    mkdir -p "$(dirname "local_ops/$__feature.yml")"
    cp "$GENESIS_ROOT/ops/$__feature.yml" "local_ops/$__feature.yml"
    merge+=( "local_ops/$__feature.yml" )
  else
    __bail "GENESIS_KIT_NAME/$GENESIS_KIT_VERSION does not support the $__feature feature"
  fi
done

merge+=( \
  overlay/base.yml \
  overlay/uaa-clients.yml \
  overlay/operations/rename-network-and-deployment.yml \
)

echo "${merge[@]}"

